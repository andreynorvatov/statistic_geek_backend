## Запуск приложения FastAPI
```bash
uvicorn app.main:app --reload --host 127.0.0.1 --port 8001 --log-level error
```
Swagger: http://127.0.0.1:8881/docs
OpenAPI документация: http://127.0.0.1:8881/openapi.json

## Структура директорий кода бекенда

* `backend/app` - TODO

## Соглашения по коду бекенда
### Миграции
1. Должны быть статическими и обратимыми
2. Генерация миграции с описательным слагом и именем. Слаг должен объяснять изменения. Установелнный для проектс шаблон наименования миграции: `*date*_*slug*.py`, пример `01-01-2024_init_migration.py`
### Наименование сущностей БД
1. lower_case_snake
2. Единственное число (`host`, `service`, `stand`)
3. Группировка похожих таблиц с перфикосм модуля ()
4. `_at` суффикс для даты и времени
5. `_date` суффикс для даты


## Запуск тестов PyTest
### Запуск тестов:
```bash
pytest
pytest -v
pytest -vv
```

### Запуск тестов с проверкой процента покрытия (в корне будет создан файл .coverage):
```bash
coverage run -m pytest
```
### Оценка покрытия кода тестами (в корне должен быть .coverage):
```bash
coverage report
```
### Запуск тестов с проверкой процента покрытия и генерацией html отчета (в корне должен быть .coverage):
```bash
coverage html --title "eco_srv_full_stack_cover"
```

## Миграции alembic
### Локальная работа с alembic (если репозиторий спулен с git, шаг можно пропустить)
<details>
<summary>При первом запуске, если файла alembic.ini ещё нет</summary>
запустить в терминале команду:

```bash
alembic init migrations
# или
alembic init -t async migrations
```
После этого будет создана папка с миграциями и конфигурационный файл для алембика.

В alembic.ini задать адрес базы данных, в которую бдует происходить накат миграций.
В папке с миграциями, файл env.py, изменения в блок:
`from myapp import mymodel`
</details>


### Создание миграции (делается при любых изменениях моделей):
```bash
alembic revision --autogenerate -m"db create"
```
### Накатывание финальной миграции
```bash
alembic upgrade heads
```
### Откат миграции на 1 ревизию
```bash
alembic downgrade -1
```

## Проверки кода
Так как backend и frontend написаны на Python, проверки кода запускать нужно для обеих частей приложения.
Общий синтаксис команд:
```
[инструмент] [действие] [директория|файл] [опциональный_флаг]
```

### Ruff
#### Проверить линтером и показать результат (без исправления):
```bash
ruff check .
```
#### Проверить линтером и ❗исправить❗ файлы:
```bash
ruff check . --fix
```
#### Проверить форматирование кода и показать результат (без исправления):
```bash
ruff format . --check
```

#### Проверить форматирование кода и ❗исправить❗ файлы:
```bash
ruff format .
```

### MyPy
#### Проверить статическую типизацию (без исправления):
```bash
mypy .
```